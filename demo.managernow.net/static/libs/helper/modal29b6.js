var Modal={$wrapper:$("#modal-wrapper"),instance:function(){return this.current().attr('id');},current:function(){return this.$wrapper.find('.modal:last-child');},count:function(){return this.$wrapper.find('.modal').length;},initialize:async function(){},loadtemplate:async function(template_id,data,opt={}){await this.initialize();var template=Twig.twig({data:document.getElementById(template_id).innerHTML});let content=$(template.render(data));Page.loadPlugins(content);return this.render(content,opt);},load:async function(template_name,data={},http={},plugins=true){let[response]=await Promise.all([await fetch(`/api/fetch/modal/${template_name}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(http),}),Global.Library.load('twigjs'),]);var html=await response.text();var template=Twig.twig({data:html});let content=$(template.render(data));if(plugins)
Page.loadPlugins(content);return content;},parse:async function(template_id,data={},plugins=true){await this.initialize();var template=Twig.twig({data:document.getElementById(template_id).innerHTML});let content=$(template.render(data));if(plugins)
Page.loadPlugins(content);return content;},render:async function(html,options={}){var self=this;var opt=$.extend(true,{stack:false,},Global.Utils.getDevice()=='smartphone'?{mode:'modal-fullpage',animation:'slideInUp',}:{mode:'',animation:'fade'},options);console.log(opt);html.attr('id','modal-'+(new Date()).getTime());html.addClass(opt.mode).addClass(opt.animation).one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){$(this).addClass('animation-off');});$('body').addClass(opt.mode);if(!opt.stack){self.$wrapper.find('.modal').modal('hide');}
else{self.$wrapper.find('.modal').addClass('modal-off');}
this.$wrapper.append(html);let current=await self.show(opt);current.find("[data-dismiss='modal']").on('click',async function(e){e.preventDefault();e.stopPropagation();await self.hide();});return current;},show:function(opt){var self=this;var dfd=$.Deferred();this.current().modal($.extend({},{show:true,},opt));this.current().on('hidden.bs.modal',async function(e){e.currentTarget.remove();if(self.$wrapper.find('.modal').not('.modal-off').length==0)
self.$wrapper.find('.modal-off').last().removeClass('modal-off');if(self.count()==0)
$('body').removeClassRegex(/^modal-/);}).on('shown.bs.modal',function(e){$(this).off('shown.bs.modal');dfd.resolve(self.current());});return dfd;},hide:function(id){var self=this;if(id){$("#"+id).modal('hide');}else{self.current().modal('hide');}
if("vibrate"in navigator){navigator.vibrate(1);}},}
var Alert={modal:async function(data,options){var dfd=$.Deferred();let $modal=await Modal.loadtemplate("modal-confirm",data,$.extend({},{stack:true,mode:'modal-alert',backdrop:'static',},options));$modal.on('hidden.bs.modal',function(e){$(this).off('hidden.bs.modal');dfd.reject();});$modal.find("#modal-confirm-btn").on("click",function(e){dfd.resolve();});return dfd;},confirm:function(title,options){return Alert.modal(title,$.extend({},{type:'Confirmar',},options));},delete:function(title,options){return Alert.modal(title,$.extend({},{type:'Borrar',},options));},success:function(phrase,message='',options){return Alert.modal({'title':'<i class="fa fa-check-circle fa-2x"></i>','msg':phrase?Global.Phrases.get(phrase):message,'type':'OK',},options);},error:function(phrase,message='',options){return Alert.modal({'title':'Oops!','msg':phrase?Global.Phrases.get(phrase):message,'type':'OK',},options);}};